package goestest

import (
	"encoding/base64"
	"fmt"
)

const (
	// MinimalIndexPageExecutableWASMPath should be used to route to the Handler
	// writing the bytes from MinimalIndexPage.
	MinimalIndexPageExecutableWASMPath = "/main.wasm"

	// MinimalIndexPageGoWASMExecPath should be used to route to the Handler
	// writing the bytes from GoWASMExec.
	MinimalIndexPageGoWASMExecPath = "/wasm_exec.js"
)

// MinimalIndexPage returns the bytes for an index.html that can be used in
// tests of main programs compiled to js/wasm.
func MinimalIndexPage() []byte {
	return []byte(fmt.Sprintf(`<!DOCTYPE html>
  <html lang="en" dir="ltr">
    <head>
      <meta charset="utf-8">
      <title>main.go</title>
      <script src=%q></script>
      <script>
				if (!WebAssembly.instantiateStreaming) { // polyfill
					WebAssembly.instantiateStreaming = async (resp, importObject) => {
						const source = await (await resp).arrayBuffer();
						return await WebAssembly.instantiate(source, importObject);
					};
				}
  			const go = new Go();
  			WebAssembly.instantiateStreaming(fetch(%q), go.importObject).then((result) => {
  				go.run(result.instance);
  			});
  		</script>
    </head>
    <body>
      <div id="main"></div>
    </body>
  </html>
  `, MinimalIndexPageGoWASMExecPath, MinimalIndexPageExecutableWASMPath))
}

// GoWASMExec returns the contents of $(go env GOROOT)/misc/wasm/wasm_exec.js
func GoWASMExec() []byte {
	decoded, _ := base64.StdEncoding.DecodeString(`Ly8gQ29weXJpZ2h0IDIwMTggVGhlIEdvIEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlCi8vIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KCigoKSA9PiB7CgkvLyBNYXAgbXVsdGlwbGUgSmF2YVNjcmlwdCBlbnZpcm9ubWVudHMgdG8gYSBzaW5nbGUgY29tbW9uIEFQSSwKCS8vIHByZWZlcnJpbmcgd2ViIHN0YW5kYXJkcyBvdmVyIE5vZGUuanMgQVBJLgoJLy8KCS8vIEVudmlyb25tZW50cyBjb25zaWRlcmVkOgoJLy8gLSBCcm93c2VycwoJLy8gLSBOb2RlLmpzCgkvLyAtIEVsZWN0cm9uCgkvLyAtIFBhcmNlbAoKCWlmICh0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIikgewoJCS8vIGdsb2JhbCBhbHJlYWR5IGV4aXN0cwoJfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIikgewoJCXdpbmRvdy5nbG9iYWwgPSB3aW5kb3c7Cgl9IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIikgewoJCXNlbGYuZ2xvYmFsID0gc2VsZjsKCX0gZWxzZSB7CgkJdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZXhwb3J0IEdvIChuZWl0aGVyIGdsb2JhbCwgd2luZG93IG5vciBzZWxmIGlzIGRlZmluZWQpIik7Cgl9CgoJaWYgKCFnbG9iYWwucmVxdWlyZSAmJiB0eXBlb2YgcmVxdWlyZSAhPT0gInVuZGVmaW5lZCIpIHsKCQlnbG9iYWwucmVxdWlyZSA9IHJlcXVpcmU7Cgl9CgoJaWYgKCFnbG9iYWwuZnMgJiYgZ2xvYmFsLnJlcXVpcmUpIHsKCQlnbG9iYWwuZnMgPSByZXF1aXJlKCJmcyIpOwoJfQoKCWlmICghZ2xvYmFsLmZzKSB7CgkJbGV0IG91dHB1dEJ1ZiA9ICIiOwoJCWdsb2JhbC5mcyA9IHsKCQkJY29uc3RhbnRzOiB7IE9fV1JPTkxZOiAtMSwgT19SRFdSOiAtMSwgT19DUkVBVDogLTEsIE9fVFJVTkM6IC0xLCBPX0FQUEVORDogLTEsIE9fRVhDTDogLTEgfSwgLy8gdW51c2VkCgkJCXdyaXRlU3luYyhmZCwgYnVmKSB7CgkJCQlvdXRwdXRCdWYgKz0gZGVjb2Rlci5kZWNvZGUoYnVmKTsKCQkJCWNvbnN0IG5sID0gb3V0cHV0QnVmLmxhc3RJbmRleE9mKCJcbiIpOwoJCQkJaWYgKG5sICE9IC0xKSB7CgkJCQkJY29uc29sZS5sb2cob3V0cHV0QnVmLnN1YnN0cigwLCBubCkpOwoJCQkJCW91dHB1dEJ1ZiA9IG91dHB1dEJ1Zi5zdWJzdHIobmwgKyAxKTsKCQkJCX0KCQkJCXJldHVybiBidWYubGVuZ3RoOwoJCQl9LAoJCQl3cml0ZShmZCwgYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIGNhbGxiYWNrKSB7CgkJCQlpZiAob2Zmc2V0ICE9PSAwIHx8IGxlbmd0aCAhPT0gYnVmLmxlbmd0aCB8fCBwb3NpdGlvbiAhPT0gbnVsbCkgewoJCQkJCXRocm93IG5ldyBFcnJvcigibm90IGltcGxlbWVudGVkIik7CgkJCQl9CgkJCQljb25zdCBuID0gdGhpcy53cml0ZVN5bmMoZmQsIGJ1Zik7CgkJCQljYWxsYmFjayhudWxsLCBuKTsKCQkJfSwKCQkJb3BlbihwYXRoLCBmbGFncywgbW9kZSwgY2FsbGJhY2spIHsKCQkJCWNvbnN0IGVyciA9IG5ldyBFcnJvcigibm90IGltcGxlbWVudGVkIik7CgkJCQllcnIuY29kZSA9ICJFTk9TWVMiOwoJCQkJY2FsbGJhY2soZXJyKTsKCQkJfSwKCQkJcmVhZChmZCwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIGNhbGxiYWNrKSB7CgkJCQljb25zdCBlcnIgPSBuZXcgRXJyb3IoIm5vdCBpbXBsZW1lbnRlZCIpOwoJCQkJZXJyLmNvZGUgPSAiRU5PU1lTIjsKCQkJCWNhbGxiYWNrKGVycik7CgkJCX0sCgkJCWZzeW5jKGZkLCBjYWxsYmFjaykgewoJCQkJY2FsbGJhY2sobnVsbCk7CgkJCX0sCgkJfTsKCX0KCglpZiAoIWdsb2JhbC5jcnlwdG8pIHsKCQljb25zdCBub2RlQ3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CgkJZ2xvYmFsLmNyeXB0byA9IHsKCQkJZ2V0UmFuZG9tVmFsdWVzKGIpIHsKCQkJCW5vZGVDcnlwdG8ucmFuZG9tRmlsbFN5bmMoYik7CgkJCX0sCgkJfTsKCX0KCglpZiAoIWdsb2JhbC5wZXJmb3JtYW5jZSkgewoJCWdsb2JhbC5wZXJmb3JtYW5jZSA9IHsKCQkJbm93KCkgewoJCQkJY29uc3QgW3NlYywgbnNlY10gPSBwcm9jZXNzLmhydGltZSgpOwoJCQkJcmV0dXJuIHNlYyAqIDEwMDAgKyBuc2VjIC8gMTAwMDAwMDsKCQkJfSwKCQl9OwoJfQoKCWlmICghZ2xvYmFsLlRleHRFbmNvZGVyKSB7CgkJZ2xvYmFsLlRleHRFbmNvZGVyID0gcmVxdWlyZSgidXRpbCIpLlRleHRFbmNvZGVyOwoJfQoKCWlmICghZ2xvYmFsLlRleHREZWNvZGVyKSB7CgkJZ2xvYmFsLlRleHREZWNvZGVyID0gcmVxdWlyZSgidXRpbCIpLlRleHREZWNvZGVyOwoJfQoKCS8vIEVuZCBvZiBwb2x5ZmlsbHMgZm9yIGNvbW1vbiBBUEkuCgoJY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigidXRmLTgiKTsKCWNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoInV0Zi04Iik7CgoJZ2xvYmFsLkdvID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKCkgewoJCQl0aGlzLmFyZ3YgPSBbImpzIl07CgkJCXRoaXMuZW52ID0ge307CgkJCXRoaXMuZXhpdCA9IChjb2RlKSA9PiB7CgkJCQlpZiAoY29kZSAhPT0gMCkgewoJCQkJCWNvbnNvbGUud2FybigiZXhpdCBjb2RlOiIsIGNvZGUpOwoJCQkJfQoJCQl9OwoJCQl0aGlzLl9leGl0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CgkJCQl0aGlzLl9yZXNvbHZlRXhpdFByb21pc2UgPSByZXNvbHZlOwoJCQl9KTsKCQkJdGhpcy5fcGVuZGluZ0V2ZW50ID0gbnVsbDsKCQkJdGhpcy5fc2NoZWR1bGVkVGltZW91dHMgPSBuZXcgTWFwKCk7CgkJCXRoaXMuX25leHRDYWxsYmFja1RpbWVvdXRJRCA9IDE7CgoJCQljb25zdCBtZW0gPSAoKSA9PiB7CgkJCQkvLyBUaGUgYnVmZmVyIG1heSBjaGFuZ2Ugd2hlbiByZXF1ZXN0aW5nIG1vcmUgbWVtb3J5LgoJCQkJcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLl9pbnN0LmV4cG9ydHMubWVtLmJ1ZmZlcik7CgkJCX0KCgkJCWNvbnN0IHNldEludDY0ID0gKGFkZHIsIHYpID0+IHsKCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyICsgMCwgdiwgdHJ1ZSk7CgkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDQsIE1hdGguZmxvb3IodiAvIDQyOTQ5NjcyOTYpLCB0cnVlKTsKCQkJfQoKCQkJY29uc3QgZ2V0SW50NjQgPSAoYWRkcikgPT4gewoJCQkJY29uc3QgbG93ID0gbWVtKCkuZ2V0VWludDMyKGFkZHIgKyAwLCB0cnVlKTsKCQkJCWNvbnN0IGhpZ2ggPSBtZW0oKS5nZXRJbnQzMihhZGRyICsgNCwgdHJ1ZSk7CgkJCQlyZXR1cm4gbG93ICsgaGlnaCAqIDQyOTQ5NjcyOTY7CgkJCX0KCgkJCWNvbnN0IGxvYWRWYWx1ZSA9IChhZGRyKSA9PiB7CgkJCQljb25zdCBmID0gbWVtKCkuZ2V0RmxvYXQ2NChhZGRyLCB0cnVlKTsKCQkJCWlmIChmID09PSAwKSB7CgkJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCQkJCX0KCQkJCWlmICghaXNOYU4oZikpIHsKCQkJCQlyZXR1cm4gZjsKCQkJCX0KCgkJCQljb25zdCBpZCA9IG1lbSgpLmdldFVpbnQzMihhZGRyLCB0cnVlKTsKCQkJCXJldHVybiB0aGlzLl92YWx1ZXNbaWRdOwoJCQl9CgoJCQljb25zdCBzdG9yZVZhbHVlID0gKGFkZHIsIHYpID0+IHsKCQkJCWNvbnN0IG5hbkhlYWQgPSAweDdGRjgwMDAwOwoKCQkJCWlmICh0eXBlb2YgdiA9PT0gIm51bWJlciIpIHsKCQkJCQlpZiAoaXNOYU4odikpIHsKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBuYW5IZWFkLCB0cnVlKTsKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIsIDAsIHRydWUpOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCWlmICh2ID09PSAwKSB7CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyICsgNCwgbmFuSGVhZCwgdHJ1ZSk7CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyLCAxLCB0cnVlKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQltZW0oKS5zZXRGbG9hdDY0KGFkZHIsIHYsIHRydWUpOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlzd2l0Y2ggKHYpIHsKCQkJCQljYXNlIHVuZGVmaW5lZDoKCQkJCQkJbWVtKCkuc2V0RmxvYXQ2NChhZGRyLCAwLCB0cnVlKTsKCQkJCQkJcmV0dXJuOwoJCQkJCWNhc2UgbnVsbDoKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBuYW5IZWFkLCB0cnVlKTsKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIsIDIsIHRydWUpOwoJCQkJCQlyZXR1cm47CgkJCQkJY2FzZSB0cnVlOgoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDQsIG5hbkhlYWQsIHRydWUpOwoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciwgMywgdHJ1ZSk7CgkJCQkJCXJldHVybjsKCQkJCQljYXNlIGZhbHNlOgoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDQsIG5hbkhlYWQsIHRydWUpOwoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciwgNCwgdHJ1ZSk7CgkJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlsZXQgcmVmID0gdGhpcy5fcmVmcy5nZXQodik7CgkJCQlpZiAocmVmID09PSB1bmRlZmluZWQpIHsKCQkJCQlyZWYgPSB0aGlzLl92YWx1ZXMubGVuZ3RoOwoJCQkJCXRoaXMuX3ZhbHVlcy5wdXNoKHYpOwoJCQkJCXRoaXMuX3JlZnMuc2V0KHYsIHJlZik7CgkJCQl9CgkJCQlsZXQgdHlwZUZsYWcgPSAwOwoJCQkJc3dpdGNoICh0eXBlb2YgdikgewoJCQkJCWNhc2UgInN0cmluZyI6CgkJCQkJCXR5cGVGbGFnID0gMTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic3ltYm9sIjoKCQkJCQkJdHlwZUZsYWcgPSAyOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJmdW5jdGlvbiI6CgkJCQkJCXR5cGVGbGFnID0gMzsKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDQsIG5hbkhlYWQgfCB0eXBlRmxhZywgdHJ1ZSk7CgkJCQltZW0oKS5zZXRVaW50MzIoYWRkciwgcmVmLCB0cnVlKTsKCQkJfQoKCQkJY29uc3QgbG9hZFNsaWNlID0gKGFkZHIpID0+IHsKCQkJCWNvbnN0IGFycmF5ID0gZ2V0SW50NjQoYWRkciArIDApOwoJCQkJY29uc3QgbGVuID0gZ2V0SW50NjQoYWRkciArIDgpOwoJCQkJcmV0dXJuIG5ldyBVaW50OEFycmF5KHRoaXMuX2luc3QuZXhwb3J0cy5tZW0uYnVmZmVyLCBhcnJheSwgbGVuKTsKCQkJfQoKCQkJY29uc3QgbG9hZFNsaWNlT2ZWYWx1ZXMgPSAoYWRkcikgPT4gewoJCQkJY29uc3QgYXJyYXkgPSBnZXRJbnQ2NChhZGRyICsgMCk7CgkJCQljb25zdCBsZW4gPSBnZXRJbnQ2NChhZGRyICsgOCk7CgkJCQljb25zdCBhID0gbmV3IEFycmF5KGxlbik7CgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkJCQkJYVtpXSA9IGxvYWRWYWx1ZShhcnJheSArIGkgKiA4KTsKCQkJCX0KCQkJCXJldHVybiBhOwoJCQl9CgoJCQljb25zdCBsb2FkU3RyaW5nID0gKGFkZHIpID0+IHsKCQkJCWNvbnN0IHNhZGRyID0gZ2V0SW50NjQoYWRkciArIDApOwoJCQkJY29uc3QgbGVuID0gZ2V0SW50NjQoYWRkciArIDgpOwoJCQkJcmV0dXJuIGRlY29kZXIuZGVjb2RlKG5ldyBEYXRhVmlldyh0aGlzLl9pbnN0LmV4cG9ydHMubWVtLmJ1ZmZlciwgc2FkZHIsIGxlbikpOwoJCQl9CgoJCQljb25zdCB0aW1lT3JpZ2luID0gRGF0ZS5ub3coKSAtIHBlcmZvcm1hbmNlLm5vdygpOwoJCQl0aGlzLmltcG9ydE9iamVjdCA9IHsKCQkJCWdvOiB7CgkJCQkJLy8gR28ncyBTUCBkb2VzIG5vdCBjaGFuZ2UgYXMgbG9uZyBhcyBubyBHbyBjb2RlIGlzIHJ1bm5pbmcuIFNvbWUgb3BlcmF0aW9ucyAoZS5nLiBjYWxscywgZ2V0dGVycyBhbmQgc2V0dGVycykKCQkJCQkvLyBtYXkgc3luY2hyb25vdXNseSB0cmlnZ2VyIGEgR28gZXZlbnQgaGFuZGxlci4gVGhpcyBtYWtlcyBHbyBjb2RlIGdldCBleGVjdXRlZCBpbiB0aGUgbWlkZGxlIG9mIHRoZSBpbXBvcnRlZAoJCQkJCS8vIGZ1bmN0aW9uLiBBIGdvcm91dGluZSBjYW4gc3dpdGNoIHRvIGEgbmV3IHN0YWNrIGlmIHRoZSBjdXJyZW50IHN0YWNrIGlzIHRvbyBzbWFsbCAoc2VlIG1vcmVzdGFjayBmdW5jdGlvbikuCgkJCQkJLy8gVGhpcyBjaGFuZ2VzIHRoZSBTUCwgdGh1cyB3ZSBoYXZlIHRvIHVwZGF0ZSB0aGUgU1AgdXNlZCBieSB0aGUgaW1wb3J0ZWQgZnVuY3Rpb24uCgoJCQkJCS8vIGZ1bmMgd2FzbUV4aXQoY29kZSBpbnQzMikKCQkJCQkicnVudGltZS53YXNtRXhpdCI6IChzcCkgPT4gewoJCQkJCQljb25zdCBjb2RlID0gbWVtKCkuZ2V0SW50MzIoc3AgKyA4LCB0cnVlKTsKCQkJCQkJdGhpcy5leGl0ZWQgPSB0cnVlOwoJCQkJCQlkZWxldGUgdGhpcy5faW5zdDsKCQkJCQkJZGVsZXRlIHRoaXMuX3ZhbHVlczsKCQkJCQkJZGVsZXRlIHRoaXMuX3JlZnM7CgkJCQkJCXRoaXMuZXhpdChjb2RlKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHdhc21Xcml0ZShmZCB1aW50cHRyLCBwIHVuc2FmZS5Qb2ludGVyLCBuIGludDMyKQoJCQkJCSJydW50aW1lLndhc21Xcml0ZSI6IChzcCkgPT4gewoJCQkJCQljb25zdCBmZCA9IGdldEludDY0KHNwICsgOCk7CgkJCQkJCWNvbnN0IHAgPSBnZXRJbnQ2NChzcCArIDE2KTsKCQkJCQkJY29uc3QgbiA9IG1lbSgpLmdldEludDMyKHNwICsgMjQsIHRydWUpOwoJCQkJCQlmcy53cml0ZVN5bmMoZmQsIG5ldyBVaW50OEFycmF5KHRoaXMuX2luc3QuZXhwb3J0cy5tZW0uYnVmZmVyLCBwLCBuKSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBuYW5vdGltZSgpIGludDY0CgkJCQkJInJ1bnRpbWUubmFub3RpbWUiOiAoc3ApID0+IHsKCQkJCQkJc2V0SW50NjQoc3AgKyA4LCAodGltZU9yaWdpbiArIHBlcmZvcm1hbmNlLm5vdygpKSAqIDEwMDAwMDApOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgd2FsbHRpbWUoKSAoc2VjIGludDY0LCBuc2VjIGludDMyKQoJCQkJCSJydW50aW1lLndhbGx0aW1lIjogKHNwKSA9PiB7CgkJCQkJCWNvbnN0IG1zZWMgPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCQkJCQkJc2V0SW50NjQoc3AgKyA4LCBtc2VjIC8gMTAwMCk7CgkJCQkJCW1lbSgpLnNldEludDMyKHNwICsgMTYsIChtc2VjICUgMTAwMCkgKiAxMDAwMDAwLCB0cnVlKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHNjaGVkdWxlVGltZW91dEV2ZW50KGRlbGF5IGludDY0KSBpbnQzMgoJCQkJCSJydW50aW1lLnNjaGVkdWxlVGltZW91dEV2ZW50IjogKHNwKSA9PiB7CgkJCQkJCWNvbnN0IGlkID0gdGhpcy5fbmV4dENhbGxiYWNrVGltZW91dElEOwoJCQkJCQl0aGlzLl9uZXh0Q2FsbGJhY2tUaW1lb3V0SUQrKzsKCQkJCQkJdGhpcy5fc2NoZWR1bGVkVGltZW91dHMuc2V0KGlkLCBzZXRUaW1lb3V0KAoJCQkJCQkJKCkgPT4gewoJCQkJCQkJCXRoaXMuX3Jlc3VtZSgpOwoJCQkJCQkJCXdoaWxlICh0aGlzLl9zY2hlZHVsZWRUaW1lb3V0cy5oYXMoaWQpKSB7CgkJCQkJCQkJCS8vIGZvciBzb21lIHJlYXNvbiBHbyBmYWlsZWQgdG8gcmVnaXN0ZXIgdGhlIHRpbWVvdXQgZXZlbnQsIGxvZyBhbmQgdHJ5IGFnYWluCgkJCQkJCQkJCS8vICh0ZW1wb3Jhcnkgd29ya2Fyb3VuZCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9nby9pc3N1ZXMvMjg5NzUpCgkJCQkJCQkJCWNvbnNvbGUud2Fybigic2NoZWR1bGVUaW1lb3V0RXZlbnQ6IG1pc3NlZCB0aW1lb3V0IGV2ZW50Iik7CgkJCQkJCQkJCXRoaXMuX3Jlc3VtZSgpOwoJCQkJCQkJCX0KCQkJCQkJCX0sCgkJCQkJCQlnZXRJbnQ2NChzcCArIDgpICsgMSwgLy8gc2V0VGltZW91dCBoYXMgYmVlbiBzZWVuIHRvIGZpcmUgdXAgdG8gMSBtaWxsaXNlY29uZCBlYXJseQoJCQkJCQkpKTsKCQkJCQkJbWVtKCkuc2V0SW50MzIoc3AgKyAxNiwgaWQsIHRydWUpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgY2xlYXJUaW1lb3V0RXZlbnQoaWQgaW50MzIpCgkJCQkJInJ1bnRpbWUuY2xlYXJUaW1lb3V0RXZlbnQiOiAoc3ApID0+IHsKCQkJCQkJY29uc3QgaWQgPSBtZW0oKS5nZXRJbnQzMihzcCArIDgsIHRydWUpOwoJCQkJCQljbGVhclRpbWVvdXQodGhpcy5fc2NoZWR1bGVkVGltZW91dHMuZ2V0KGlkKSk7CgkJCQkJCXRoaXMuX3NjaGVkdWxlZFRpbWVvdXRzLmRlbGV0ZShpZCk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBnZXRSYW5kb21EYXRhKHIgW11ieXRlKQoJCQkJCSJydW50aW1lLmdldFJhbmRvbURhdGEiOiAoc3ApID0+IHsKCQkJCQkJY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhsb2FkU2xpY2Uoc3AgKyA4KSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBzdHJpbmdWYWwodmFsdWUgc3RyaW5nKSByZWYKCQkJCQkic3lzY2FsbC9qcy5zdHJpbmdWYWwiOiAoc3ApID0+IHsKCQkJCQkJc3RvcmVWYWx1ZShzcCArIDI0LCBsb2FkU3RyaW5nKHNwICsgOCkpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgdmFsdWVHZXQodiByZWYsIHAgc3RyaW5nKSByZWYKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUdldCI6IChzcCkgPT4gewoJCQkJCQljb25zdCByZXN1bHQgPSBSZWZsZWN0LmdldChsb2FkVmFsdWUoc3AgKyA4KSwgbG9hZFN0cmluZyhzcCArIDE2KSk7CgkJCQkJCXNwID0gdGhpcy5faW5zdC5leHBvcnRzLmdldHNwKCk7IC8vIHNlZSBjb21tZW50IGFib3ZlCgkJCQkJCXN0b3JlVmFsdWUoc3AgKyAzMiwgcmVzdWx0KTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlU2V0KHYgcmVmLCBwIHN0cmluZywgeCByZWYpCgkJCQkJInN5c2NhbGwvanMudmFsdWVTZXQiOiAoc3ApID0+IHsKCQkJCQkJUmVmbGVjdC5zZXQobG9hZFZhbHVlKHNwICsgOCksIGxvYWRTdHJpbmcoc3AgKyAxNiksIGxvYWRWYWx1ZShzcCArIDMyKSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZUluZGV4KHYgcmVmLCBpIGludCkgcmVmCgkJCQkJInN5c2NhbGwvanMudmFsdWVJbmRleCI6IChzcCkgPT4gewoJCQkJCQlzdG9yZVZhbHVlKHNwICsgMjQsIFJlZmxlY3QuZ2V0KGxvYWRWYWx1ZShzcCArIDgpLCBnZXRJbnQ2NChzcCArIDE2KSkpOwoJCQkJCX0sCgoJCQkJCS8vIHZhbHVlU2V0SW5kZXgodiByZWYsIGkgaW50LCB4IHJlZikKCQkJCQkic3lzY2FsbC9qcy52YWx1ZVNldEluZGV4IjogKHNwKSA9PiB7CgkJCQkJCVJlZmxlY3Quc2V0KGxvYWRWYWx1ZShzcCArIDgpLCBnZXRJbnQ2NChzcCArIDE2KSwgbG9hZFZhbHVlKHNwICsgMjQpKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlQ2FsbCh2IHJlZiwgbSBzdHJpbmcsIGFyZ3MgW11yZWYpIChyZWYsIGJvb2wpCgkJCQkJInN5c2NhbGwvanMudmFsdWVDYWxsIjogKHNwKSA9PiB7CgkJCQkJCXRyeSB7CgkJCQkJCQljb25zdCB2ID0gbG9hZFZhbHVlKHNwICsgOCk7CgkJCQkJCQljb25zdCBtID0gUmVmbGVjdC5nZXQodiwgbG9hZFN0cmluZyhzcCArIDE2KSk7CgkJCQkJCQljb25zdCBhcmdzID0gbG9hZFNsaWNlT2ZWYWx1ZXMoc3AgKyAzMik7CgkJCQkJCQljb25zdCByZXN1bHQgPSBSZWZsZWN0LmFwcGx5KG0sIHYsIGFyZ3MpOwoJCQkJCQkJc3AgPSB0aGlzLl9pbnN0LmV4cG9ydHMuZ2V0c3AoKTsgLy8gc2VlIGNvbW1lbnQgYWJvdmUKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA1NiwgcmVzdWx0KTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNjQsIDEpOwoJCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA1NiwgZXJyKTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNjQsIDApOwoJCQkJCQl9CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZUludm9rZSh2IHJlZiwgYXJncyBbXXJlZikgKHJlZiwgYm9vbCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUludm9rZSI6IChzcCkgPT4gewoJCQkJCQl0cnkgewoJCQkJCQkJY29uc3QgdiA9IGxvYWRWYWx1ZShzcCArIDgpOwoJCQkJCQkJY29uc3QgYXJncyA9IGxvYWRTbGljZU9mVmFsdWVzKHNwICsgMTYpOwoJCQkJCQkJY29uc3QgcmVzdWx0ID0gUmVmbGVjdC5hcHBseSh2LCB1bmRlZmluZWQsIGFyZ3MpOwoJCQkJCQkJc3AgPSB0aGlzLl9pbnN0LmV4cG9ydHMuZ2V0c3AoKTsgLy8gc2VlIGNvbW1lbnQgYWJvdmUKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA0MCwgcmVzdWx0KTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNDgsIDEpOwoJCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA0MCwgZXJyKTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNDgsIDApOwoJCQkJCQl9CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZU5ldyh2IHJlZiwgYXJncyBbXXJlZikgKHJlZiwgYm9vbCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZU5ldyI6IChzcCkgPT4gewoJCQkJCQl0cnkgewoJCQkJCQkJY29uc3QgdiA9IGxvYWRWYWx1ZShzcCArIDgpOwoJCQkJCQkJY29uc3QgYXJncyA9IGxvYWRTbGljZU9mVmFsdWVzKHNwICsgMTYpOwoJCQkJCQkJY29uc3QgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QodiwgYXJncyk7CgkJCQkJCQlzcCA9IHRoaXMuX2luc3QuZXhwb3J0cy5nZXRzcCgpOyAvLyBzZWUgY29tbWVudCBhYm92ZQoJCQkJCQkJc3RvcmVWYWx1ZShzcCArIDQwLCByZXN1bHQpOwoJCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMSk7CgkJCQkJCX0gY2F0Y2ggKGVycikgewoJCQkJCQkJc3RvcmVWYWx1ZShzcCArIDQwLCBlcnIpOwoJCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMCk7CgkJCQkJCX0KCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlTGVuZ3RoKHYgcmVmKSBpbnQKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUxlbmd0aCI6IChzcCkgPT4gewoJCQkJCQlzZXRJbnQ2NChzcCArIDE2LCBwYXJzZUludChsb2FkVmFsdWUoc3AgKyA4KS5sZW5ndGgpKTsKCQkJCQl9LAoKCQkJCQkvLyB2YWx1ZVByZXBhcmVTdHJpbmcodiByZWYpIChyZWYsIGludCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZVByZXBhcmVTdHJpbmciOiAoc3ApID0+IHsKCQkJCQkJY29uc3Qgc3RyID0gZW5jb2Rlci5lbmNvZGUoU3RyaW5nKGxvYWRWYWx1ZShzcCArIDgpKSk7CgkJCQkJCXN0b3JlVmFsdWUoc3AgKyAxNiwgc3RyKTsKCQkJCQkJc2V0SW50NjQoc3AgKyAyNCwgc3RyLmxlbmd0aCk7CgkJCQkJfSwKCgkJCQkJLy8gdmFsdWVMb2FkU3RyaW5nKHYgcmVmLCBiIFtdYnl0ZSkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUxvYWRTdHJpbmciOiAoc3ApID0+IHsKCQkJCQkJY29uc3Qgc3RyID0gbG9hZFZhbHVlKHNwICsgOCk7CgkJCQkJCWxvYWRTbGljZShzcCArIDE2KS5zZXQoc3RyKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlSW5zdGFuY2VPZih2IHJlZiwgdCByZWYpIGJvb2wKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUluc3RhbmNlT2YiOiAoc3ApID0+IHsKCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyAyNCwgbG9hZFZhbHVlKHNwICsgOCkgaW5zdGFuY2VvZiBsb2FkVmFsdWUoc3AgKyAxNikpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgY29weUJ5dGVzVG9Hbyhkc3QgW11ieXRlLCBzcmMgcmVmKSAoaW50LCBib29sKQoJCQkJCSJzeXNjYWxsL2pzLmNvcHlCeXRlc1RvR28iOiAoc3ApID0+IHsKCQkJCQkJY29uc3QgZHN0ID0gbG9hZFNsaWNlKHNwICsgOCk7CgkJCQkJCWNvbnN0IHNyYyA9IGxvYWRWYWx1ZShzcCArIDMyKTsKCQkJCQkJaWYgKCEoc3JjIGluc3RhbmNlb2YgVWludDhBcnJheSkpIHsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNDgsIDApOwoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJCWNvbnN0IHRvQ29weSA9IHNyYy5zdWJhcnJheSgwLCBkc3QubGVuZ3RoKTsKCQkJCQkJZHN0LnNldCh0b0NvcHkpOwoJCQkJCQlzZXRJbnQ2NChzcCArIDQwLCB0b0NvcHkubGVuZ3RoKTsKCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBjb3B5Qnl0ZXNUb0pTKGRzdCByZWYsIHNyYyBbXWJ5dGUpIChpbnQsIGJvb2wpCgkJCQkJInN5c2NhbGwvanMuY29weUJ5dGVzVG9KUyI6IChzcCkgPT4gewoJCQkJCQljb25zdCBkc3QgPSBsb2FkVmFsdWUoc3AgKyA4KTsKCQkJCQkJY29uc3Qgc3JjID0gbG9hZFNsaWNlKHNwICsgMTYpOwoJCQkJCQlpZiAoIShkc3QgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkgewoJCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMCk7CgkJCQkJCQlyZXR1cm47CgkJCQkJCX0KCQkJCQkJY29uc3QgdG9Db3B5ID0gc3JjLnN1YmFycmF5KDAsIGRzdC5sZW5ndGgpOwoJCQkJCQlkc3Quc2V0KHRvQ29weSk7CgkJCQkJCXNldEludDY0KHNwICsgNDAsIHRvQ29weS5sZW5ndGgpOwoJCQkJCQltZW0oKS5zZXRVaW50OChzcCArIDQ4LCAxKTsKCQkJCQl9LAoKCQkJCQkiZGVidWciOiAodmFsdWUpID0+IHsKCQkJCQkJY29uc29sZS5sb2codmFsdWUpOwoJCQkJCX0sCgkJCQl9CgkJCX07CgkJfQoKCQlhc3luYyBydW4oaW5zdGFuY2UpIHsKCQkJdGhpcy5faW5zdCA9IGluc3RhbmNlOwoJCQl0aGlzLl92YWx1ZXMgPSBbIC8vIFRPRE86IGdhcmJhZ2UgY29sbGVjdGlvbgoJCQkJTmFOLAoJCQkJMCwKCQkJCW51bGwsCgkJCQl0cnVlLAoJCQkJZmFsc2UsCgkJCQlnbG9iYWwsCgkJCQl0aGlzLAoJCQldOwoJCQl0aGlzLl9yZWZzID0gbmV3IE1hcCgpOwoJCQl0aGlzLmV4aXRlZCA9IGZhbHNlOwoKCQkJY29uc3QgbWVtID0gbmV3IERhdGFWaWV3KHRoaXMuX2luc3QuZXhwb3J0cy5tZW0uYnVmZmVyKQoKCQkJLy8gUGFzcyBjb21tYW5kIGxpbmUgYXJndW1lbnRzIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgdG8gV2ViQXNzZW1ibHkgYnkgd3JpdGluZyB0aGVtIHRvIHRoZSBsaW5lYXIgbWVtb3J5LgoJCQlsZXQgb2Zmc2V0ID0gNDA5NjsKCgkJCWNvbnN0IHN0clB0ciA9IChzdHIpID0+IHsKCQkJCWNvbnN0IHB0ciA9IG9mZnNldDsKCQkJCWNvbnN0IGJ5dGVzID0gZW5jb2Rlci5lbmNvZGUoc3RyICsgIlwwIik7CgkJCQluZXcgVWludDhBcnJheShtZW0uYnVmZmVyLCBvZmZzZXQsIGJ5dGVzLmxlbmd0aCkuc2V0KGJ5dGVzKTsKCQkJCW9mZnNldCArPSBieXRlcy5sZW5ndGg7CgkJCQlpZiAob2Zmc2V0ICUgOCAhPT0gMCkgewoJCQkJCW9mZnNldCArPSA4IC0gKG9mZnNldCAlIDgpOwoJCQkJfQoJCQkJcmV0dXJuIHB0cjsKCQkJfTsKCgkJCWNvbnN0IGFyZ2MgPSB0aGlzLmFyZ3YubGVuZ3RoOwoKCQkJY29uc3QgYXJndlB0cnMgPSBbXTsKCQkJdGhpcy5hcmd2LmZvckVhY2goKGFyZykgPT4gewoJCQkJYXJndlB0cnMucHVzaChzdHJQdHIoYXJnKSk7CgkJCX0pOwoKCQkJY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuZW52KS5zb3J0KCk7CgkJCWFyZ3ZQdHJzLnB1c2goa2V5cy5sZW5ndGgpOwoJCQlrZXlzLmZvckVhY2goKGtleSkgPT4gewoJCQkJYXJndlB0cnMucHVzaChzdHJQdHIoYCR7a2V5fT0ke3RoaXMuZW52W2tleV19YCkpOwoJCQl9KTsKCgkJCWNvbnN0IGFyZ3YgPSBvZmZzZXQ7CgkJCWFyZ3ZQdHJzLmZvckVhY2goKHB0cikgPT4gewoJCQkJbWVtLnNldFVpbnQzMihvZmZzZXQsIHB0ciwgdHJ1ZSk7CgkJCQltZW0uc2V0VWludDMyKG9mZnNldCArIDQsIDAsIHRydWUpOwoJCQkJb2Zmc2V0ICs9IDg7CgkJCX0pOwoKCQkJdGhpcy5faW5zdC5leHBvcnRzLnJ1bihhcmdjLCBhcmd2KTsKCQkJaWYgKHRoaXMuZXhpdGVkKSB7CgkJCQl0aGlzLl9yZXNvbHZlRXhpdFByb21pc2UoKTsKCQkJfQoJCQlhd2FpdCB0aGlzLl9leGl0UHJvbWlzZTsKCQl9CgoJCV9yZXN1bWUoKSB7CgkJCWlmICh0aGlzLmV4aXRlZCkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCJHbyBwcm9ncmFtIGhhcyBhbHJlYWR5IGV4aXRlZCIpOwoJCQl9CgkJCXRoaXMuX2luc3QuZXhwb3J0cy5yZXN1bWUoKTsKCQkJaWYgKHRoaXMuZXhpdGVkKSB7CgkJCQl0aGlzLl9yZXNvbHZlRXhpdFByb21pc2UoKTsKCQkJfQoJCX0KCgkJX21ha2VGdW5jV3JhcHBlcihpZCkgewoJCQljb25zdCBnbyA9IHRoaXM7CgkJCXJldHVybiBmdW5jdGlvbiAoKSB7CgkJCQljb25zdCBldmVudCA9IHsgaWQ6IGlkLCB0aGlzOiB0aGlzLCBhcmdzOiBhcmd1bWVudHMgfTsKCQkJCWdvLl9wZW5kaW5nRXZlbnQgPSBldmVudDsKCQkJCWdvLl9yZXN1bWUoKTsKCQkJCXJldHVybiBldmVudC5yZXN1bHQ7CgkJCX07CgkJfQoJfQoKCWlmICgKCQlnbG9iYWwucmVxdWlyZSAmJgoJCWdsb2JhbC5yZXF1aXJlLm1haW4gPT09IG1vZHVsZSAmJgoJCWdsb2JhbC5wcm9jZXNzICYmCgkJZ2xvYmFsLnByb2Nlc3MudmVyc2lvbnMgJiYKCQkhZ2xvYmFsLnByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24KCSkgewoJCWlmIChwcm9jZXNzLmFyZ3YubGVuZ3RoIDwgMykgewoJCQljb25zb2xlLmVycm9yKCJ1c2FnZTogZ29fanNfd2FzbV9leGVjIFt3YXNtIGJpbmFyeV0gW2FyZ3VtZW50c10iKTsKCQkJcHJvY2Vzcy5leGl0KDEpOwoJCX0KCgkJY29uc3QgZ28gPSBuZXcgR28oKTsKCQlnby5hcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpOwoJCWdvLmVudiA9IE9iamVjdC5hc3NpZ24oeyBUTVBESVI6IHJlcXVpcmUoIm9zIikudG1wZGlyKCkgfSwgcHJvY2Vzcy5lbnYpOwoJCWdvLmV4aXQgPSBwcm9jZXNzLmV4aXQ7CgkJV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoZnMucmVhZEZpbGVTeW5jKHByb2Nlc3MuYXJndlsyXSksIGdvLmltcG9ydE9iamVjdCkudGhlbigocmVzdWx0KSA9PiB7CgkJCXByb2Nlc3Mub24oImV4aXQiLCAoY29kZSkgPT4geyAvLyBOb2RlLmpzIGV4aXRzIGlmIG5vIGV2ZW50IGhhbmRsZXIgaXMgcGVuZGluZwoJCQkJaWYgKGNvZGUgPT09IDAgJiYgIWdvLmV4aXRlZCkgewoJCQkJCS8vIGRlYWRsb2NrLCBtYWtlIEdvIHByaW50IGVycm9yIGFuZCBzdGFjayB0cmFjZXMKCQkJCQlnby5fcGVuZGluZ0V2ZW50ID0geyBpZDogMCB9OwoJCQkJCWdvLl9yZXN1bWUoKTsKCQkJCX0KCQkJfSk7CgkJCXJldHVybiBnby5ydW4ocmVzdWx0Lmluc3RhbmNlKTsKCQl9KS5jYXRjaCgoZXJyKSA9PiB7CgkJCWNvbnNvbGUuZXJyb3IoZXJyKTsKCQkJcHJvY2Vzcy5leGl0KDEpOwoJCX0pOwoJfQp9KSgpOwo=
`)

	return decoded
}

// The name "goes" was triggered by the words "Go" and "EcmaScript"... duh.
