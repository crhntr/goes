package goestest

import (
	"encoding/base64"
	"fmt"
)

const (
	MinimalIndexPageExecutableWASMPath = "/main.wasm"
	MinimalIndexPageGoWASMExecPath     = "/wasm_exec.js"
)

func MinimalIndexPage() []byte {
	return []byte(fmt.Sprintf(`<!DOCTYPE html>
  <html lang="en" dir="ltr">
    <head>
      <meta charset="utf-8">
      <title>main.go</title>
      <script src=%q></script>
      <script>
  			const go = new Go();
  			WebAssembly.instantiateStreaming(fetch(%q), go.importObject).then((result) => {
  				go.run(result.instance);
  			});
  		</script>
    </head>
    <body>
      <div id="main"></div>
    </body>
  </html>
  `, MinimalIndexPageGoWASMExecPath, MinimalIndexPageExecutableWASMPath))
}

func GoWASMExec() []byte {
	decoded, _ := base64.StdEncoding.DecodeString(`Ly8gQ29weXJpZ2h0IDIwMTggVGhlIEdvIEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlCi8vIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KCigoKSA9PiB7CglpZiAodHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIpIHsKCQkvLyBnbG9iYWwgYWxyZWFkeSBleGlzdHMKCX0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKCQl3aW5kb3cuZ2xvYmFsID0gd2luZG93OwoJfSBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIpIHsKCQlzZWxmLmdsb2JhbCA9IHNlbGY7Cgl9IGVsc2UgewoJCXRocm93IG5ldyBFcnJvcigiY2Fubm90IGV4cG9ydCBHbyAobmVpdGhlciBnbG9iYWwsIHdpbmRvdyBub3Igc2VsZiBpcyBkZWZpbmVkKSIpOwoJfQoKCS8vIE1hcCB3ZWIgYnJvd3NlciBBUEkgYW5kIE5vZGUuanMgQVBJIHRvIGEgc2luZ2xlIGNvbW1vbiBBUEkgKHByZWZlcnJpbmcgd2ViIHN0YW5kYXJkcyBvdmVyIE5vZGUuanMgQVBJKS4KCWNvbnN0IGlzTm9kZUpTID0gZ2xvYmFsLnByb2Nlc3MgJiYgZ2xvYmFsLnByb2Nlc3MudGl0bGUgPT09ICJub2RlIjsKCWlmIChpc05vZGVKUykgewoJCWdsb2JhbC5yZXF1aXJlID0gcmVxdWlyZTsKCQlnbG9iYWwuZnMgPSByZXF1aXJlKCJmcyIpOwoKCQljb25zdCBub2RlQ3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CgkJZ2xvYmFsLmNyeXB0byA9IHsKCQkJZ2V0UmFuZG9tVmFsdWVzKGIpIHsKCQkJCW5vZGVDcnlwdG8ucmFuZG9tRmlsbFN5bmMoYik7CgkJCX0sCgkJfTsKCgkJZ2xvYmFsLnBlcmZvcm1hbmNlID0gewoJCQlub3coKSB7CgkJCQljb25zdCBbc2VjLCBuc2VjXSA9IHByb2Nlc3MuaHJ0aW1lKCk7CgkJCQlyZXR1cm4gc2VjICogMTAwMCArIG5zZWMgLyAxMDAwMDAwOwoJCQl9LAoJCX07CgoJCWNvbnN0IHV0aWwgPSByZXF1aXJlKCJ1dGlsIik7CgkJZ2xvYmFsLlRleHRFbmNvZGVyID0gdXRpbC5UZXh0RW5jb2RlcjsKCQlnbG9iYWwuVGV4dERlY29kZXIgPSB1dGlsLlRleHREZWNvZGVyOwoJfSBlbHNlIHsKCQlsZXQgb3V0cHV0QnVmID0gIiI7CgkJZ2xvYmFsLmZzID0gewoJCQljb25zdGFudHM6IHsgT19XUk9OTFk6IC0xLCBPX1JEV1I6IC0xLCBPX0NSRUFUOiAtMSwgT19UUlVOQzogLTEsIE9fQVBQRU5EOiAtMSwgT19FWENMOiAtMSB9LCAvLyB1bnVzZWQKCQkJd3JpdGVTeW5jKGZkLCBidWYpIHsKCQkJCW91dHB1dEJ1ZiArPSBkZWNvZGVyLmRlY29kZShidWYpOwoJCQkJY29uc3QgbmwgPSBvdXRwdXRCdWYubGFzdEluZGV4T2YoIlxuIik7CgkJCQlpZiAobmwgIT0gLTEpIHsKCQkJCQljb25zb2xlLmxvZyhvdXRwdXRCdWYuc3Vic3RyKDAsIG5sKSk7CgkJCQkJb3V0cHV0QnVmID0gb3V0cHV0QnVmLnN1YnN0cihubCArIDEpOwoJCQkJfQoJCQkJcmV0dXJuIGJ1Zi5sZW5ndGg7CgkJCX0sCgkJCXdyaXRlKGZkLCBidWYsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgY2FsbGJhY2spIHsKCQkJCWlmIChvZmZzZXQgIT09IDAgfHwgbGVuZ3RoICE9PSBidWYubGVuZ3RoIHx8IHBvc2l0aW9uICE9PSBudWxsKSB7CgkJCQkJdGhyb3cgbmV3IEVycm9yKCJub3QgaW1wbGVtZW50ZWQiKTsKCQkJCX0KCQkJCWNvbnN0IG4gPSB0aGlzLndyaXRlU3luYyhmZCwgYnVmKTsKCQkJCWNhbGxiYWNrKG51bGwsIG4pOwoJCQl9LAoJCQlvcGVuKHBhdGgsIGZsYWdzLCBtb2RlLCBjYWxsYmFjaykgewoJCQkJY29uc3QgZXJyID0gbmV3IEVycm9yKCJub3QgaW1wbGVtZW50ZWQiKTsKCQkJCWVyci5jb2RlID0gIkVOT1NZUyI7CgkJCQljYWxsYmFjayhlcnIpOwoJCQl9LAoJCQlyZWFkKGZkLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgY2FsbGJhY2spIHsKCQkJCWNvbnN0IGVyciA9IG5ldyBFcnJvcigibm90IGltcGxlbWVudGVkIik7CgkJCQllcnIuY29kZSA9ICJFTk9TWVMiOwoJCQkJY2FsbGJhY2soZXJyKTsKCQkJfSwKCQkJZnN5bmMoZmQsIGNhbGxiYWNrKSB7CgkJCQljYWxsYmFjayhudWxsKTsKCQkJfSwKCQl9OwoJfQoKCWNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoInV0Zi04Iik7Cgljb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpOwoKCWdsb2JhbC5HbyA9IGNsYXNzIHsKCQljb25zdHJ1Y3RvcigpIHsKCQkJdGhpcy5hcmd2ID0gWyJqcyJdOwoJCQl0aGlzLmVudiA9IHt9OwoJCQl0aGlzLmV4aXQgPSAoY29kZSkgPT4gewoJCQkJaWYgKGNvZGUgIT09IDApIHsKCQkJCQljb25zb2xlLndhcm4oImV4aXQgY29kZToiLCBjb2RlKTsKCQkJCX0KCQkJfTsKCQkJdGhpcy5fZXhpdFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewoJCQkJdGhpcy5fcmVzb2x2ZUV4aXRQcm9taXNlID0gcmVzb2x2ZTsKCQkJfSk7CgkJCXRoaXMuX3BlbmRpbmdFdmVudCA9IG51bGw7CgkJCXRoaXMuX3NjaGVkdWxlZFRpbWVvdXRzID0gbmV3IE1hcCgpOwoJCQl0aGlzLl9uZXh0Q2FsbGJhY2tUaW1lb3V0SUQgPSAxOwoKCQkJY29uc3QgbWVtID0gKCkgPT4gewoJCQkJLy8gVGhlIGJ1ZmZlciBtYXkgY2hhbmdlIHdoZW4gcmVxdWVzdGluZyBtb3JlIG1lbW9yeS4KCQkJCXJldHVybiBuZXcgRGF0YVZpZXcodGhpcy5faW5zdC5leHBvcnRzLm1lbS5idWZmZXIpOwoJCQl9CgoJCQljb25zdCBzZXRJbnQ2NCA9IChhZGRyLCB2KSA9PiB7CgkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDAsIHYsIHRydWUpOwoJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBNYXRoLmZsb29yKHYgLyA0Mjk0OTY3Mjk2KSwgdHJ1ZSk7CgkJCX0KCgkJCWNvbnN0IGdldEludDY0ID0gKGFkZHIpID0+IHsKCQkJCWNvbnN0IGxvdyA9IG1lbSgpLmdldFVpbnQzMihhZGRyICsgMCwgdHJ1ZSk7CgkJCQljb25zdCBoaWdoID0gbWVtKCkuZ2V0SW50MzIoYWRkciArIDQsIHRydWUpOwoJCQkJcmV0dXJuIGxvdyArIGhpZ2ggKiA0Mjk0OTY3Mjk2OwoJCQl9CgoJCQljb25zdCBsb2FkVmFsdWUgPSAoYWRkcikgPT4gewoJCQkJY29uc3QgZiA9IG1lbSgpLmdldEZsb2F0NjQoYWRkciwgdHJ1ZSk7CgkJCQlpZiAoZiA9PT0gMCkgewoJCQkJCXJldHVybiB1bmRlZmluZWQ7CgkJCQl9CgkJCQlpZiAoIWlzTmFOKGYpKSB7CgkJCQkJcmV0dXJuIGY7CgkJCQl9CgoJCQkJY29uc3QgaWQgPSBtZW0oKS5nZXRVaW50MzIoYWRkciwgdHJ1ZSk7CgkJCQlyZXR1cm4gdGhpcy5fdmFsdWVzW2lkXTsKCQkJfQoKCQkJY29uc3Qgc3RvcmVWYWx1ZSA9IChhZGRyLCB2KSA9PiB7CgkJCQljb25zdCBuYW5IZWFkID0gMHg3RkY4MDAwMDsKCgkJCQlpZiAodHlwZW9mIHYgPT09ICJudW1iZXIiKSB7CgkJCQkJaWYgKGlzTmFOKHYpKSB7CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyICsgNCwgbmFuSGVhZCwgdHJ1ZSk7CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyLCAwLCB0cnVlKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQlpZiAodiA9PT0gMCkgewoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciArIDQsIG5hbkhlYWQsIHRydWUpOwoJCQkJCQltZW0oKS5zZXRVaW50MzIoYWRkciwgMSwgdHJ1ZSk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJbWVtKCkuc2V0RmxvYXQ2NChhZGRyLCB2LCB0cnVlKTsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJc3dpdGNoICh2KSB7CgkJCQkJY2FzZSB1bmRlZmluZWQ6CgkJCQkJCW1lbSgpLnNldEZsb2F0NjQoYWRkciwgMCwgdHJ1ZSk7CgkJCQkJCXJldHVybjsKCQkJCQljYXNlIG51bGw6CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyICsgNCwgbmFuSGVhZCwgdHJ1ZSk7CgkJCQkJCW1lbSgpLnNldFVpbnQzMihhZGRyLCAyLCB0cnVlKTsKCQkJCQkJcmV0dXJuOwoJCQkJCWNhc2UgdHJ1ZToKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBuYW5IZWFkLCB0cnVlKTsKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIsIDMsIHRydWUpOwoJCQkJCQlyZXR1cm47CgkJCQkJY2FzZSBmYWxzZToKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBuYW5IZWFkLCB0cnVlKTsKCQkJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIsIDQsIHRydWUpOwoJCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJbGV0IHJlZiA9IHRoaXMuX3JlZnMuZ2V0KHYpOwoJCQkJaWYgKHJlZiA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJcmVmID0gdGhpcy5fdmFsdWVzLmxlbmd0aDsKCQkJCQl0aGlzLl92YWx1ZXMucHVzaCh2KTsKCQkJCQl0aGlzLl9yZWZzLnNldCh2LCByZWYpOwoJCQkJfQoJCQkJbGV0IHR5cGVGbGFnID0gMDsKCQkJCXN3aXRjaCAodHlwZW9mIHYpIHsKCQkJCQljYXNlICJzdHJpbmciOgoJCQkJCQl0eXBlRmxhZyA9IDE7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInN5bWJvbCI6CgkJCQkJCXR5cGVGbGFnID0gMjsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZnVuY3Rpb24iOgoJCQkJCQl0eXBlRmxhZyA9IDM7CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIgKyA0LCBuYW5IZWFkIHwgdHlwZUZsYWcsIHRydWUpOwoJCQkJbWVtKCkuc2V0VWludDMyKGFkZHIsIHJlZiwgdHJ1ZSk7CgkJCX0KCgkJCWNvbnN0IGxvYWRTbGljZSA9IChhZGRyKSA9PiB7CgkJCQljb25zdCBhcnJheSA9IGdldEludDY0KGFkZHIgKyAwKTsKCQkJCWNvbnN0IGxlbiA9IGdldEludDY0KGFkZHIgKyA4KTsKCQkJCXJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLl9pbnN0LmV4cG9ydHMubWVtLmJ1ZmZlciwgYXJyYXksIGxlbik7CgkJCX0KCgkJCWNvbnN0IGxvYWRTbGljZU9mVmFsdWVzID0gKGFkZHIpID0+IHsKCQkJCWNvbnN0IGFycmF5ID0gZ2V0SW50NjQoYWRkciArIDApOwoJCQkJY29uc3QgbGVuID0gZ2V0SW50NjQoYWRkciArIDgpOwoJCQkJY29uc3QgYSA9IG5ldyBBcnJheShsZW4pOwoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykgewoJCQkJCWFbaV0gPSBsb2FkVmFsdWUoYXJyYXkgKyBpICogOCk7CgkJCQl9CgkJCQlyZXR1cm4gYTsKCQkJfQoKCQkJY29uc3QgbG9hZFN0cmluZyA9IChhZGRyKSA9PiB7CgkJCQljb25zdCBzYWRkciA9IGdldEludDY0KGFkZHIgKyAwKTsKCQkJCWNvbnN0IGxlbiA9IGdldEludDY0KGFkZHIgKyA4KTsKCQkJCXJldHVybiBkZWNvZGVyLmRlY29kZShuZXcgRGF0YVZpZXcodGhpcy5faW5zdC5leHBvcnRzLm1lbS5idWZmZXIsIHNhZGRyLCBsZW4pKTsKCQkJfQoKCQkJY29uc3QgdGltZU9yaWdpbiA9IERhdGUubm93KCkgLSBwZXJmb3JtYW5jZS5ub3coKTsKCQkJdGhpcy5pbXBvcnRPYmplY3QgPSB7CgkJCQlnbzogewoJCQkJCS8vIEdvJ3MgU1AgZG9lcyBub3QgY2hhbmdlIGFzIGxvbmcgYXMgbm8gR28gY29kZSBpcyBydW5uaW5nLiBTb21lIG9wZXJhdGlvbnMgKGUuZy4gY2FsbHMsIGdldHRlcnMgYW5kIHNldHRlcnMpCgkJCQkJLy8gbWF5IHN5bmNocm9ub3VzbHkgdHJpZ2dlciBhIEdvIGV2ZW50IGhhbmRsZXIuIFRoaXMgbWFrZXMgR28gY29kZSBnZXQgZXhlY3V0ZWQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgaW1wb3J0ZWQKCQkJCQkvLyBmdW5jdGlvbi4gQSBnb3JvdXRpbmUgY2FuIHN3aXRjaCB0byBhIG5ldyBzdGFjayBpZiB0aGUgY3VycmVudCBzdGFjayBpcyB0b28gc21hbGwgKHNlZSBtb3Jlc3RhY2sgZnVuY3Rpb24pLgoJCQkJCS8vIFRoaXMgY2hhbmdlcyB0aGUgU1AsIHRodXMgd2UgaGF2ZSB0byB1cGRhdGUgdGhlIFNQIHVzZWQgYnkgdGhlIGltcG9ydGVkIGZ1bmN0aW9uLgoKCQkJCQkvLyBmdW5jIHdhc21FeGl0KGNvZGUgaW50MzIpCgkJCQkJInJ1bnRpbWUud2FzbUV4aXQiOiAoc3ApID0+IHsKCQkJCQkJY29uc3QgY29kZSA9IG1lbSgpLmdldEludDMyKHNwICsgOCwgdHJ1ZSk7CgkJCQkJCXRoaXMuZXhpdGVkID0gdHJ1ZTsKCQkJCQkJZGVsZXRlIHRoaXMuX2luc3Q7CgkJCQkJCWRlbGV0ZSB0aGlzLl92YWx1ZXM7CgkJCQkJCWRlbGV0ZSB0aGlzLl9yZWZzOwoJCQkJCQl0aGlzLmV4aXQoY29kZSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB3YXNtV3JpdGUoZmQgdWludHB0ciwgcCB1bnNhZmUuUG9pbnRlciwgbiBpbnQzMikKCQkJCQkicnVudGltZS53YXNtV3JpdGUiOiAoc3ApID0+IHsKCQkJCQkJY29uc3QgZmQgPSBnZXRJbnQ2NChzcCArIDgpOwoJCQkJCQljb25zdCBwID0gZ2V0SW50NjQoc3AgKyAxNik7CgkJCQkJCWNvbnN0IG4gPSBtZW0oKS5nZXRJbnQzMihzcCArIDI0LCB0cnVlKTsKCQkJCQkJZnMud3JpdGVTeW5jKGZkLCBuZXcgVWludDhBcnJheSh0aGlzLl9pbnN0LmV4cG9ydHMubWVtLmJ1ZmZlciwgcCwgbikpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgbmFub3RpbWUoKSBpbnQ2NAoJCQkJCSJydW50aW1lLm5hbm90aW1lIjogKHNwKSA9PiB7CgkJCQkJCXNldEludDY0KHNwICsgOCwgKHRpbWVPcmlnaW4gKyBwZXJmb3JtYW5jZS5ub3coKSkgKiAxMDAwMDAwKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHdhbGx0aW1lKCkgKHNlYyBpbnQ2NCwgbnNlYyBpbnQzMikKCQkJCQkicnVudGltZS53YWxsdGltZSI6IChzcCkgPT4gewoJCQkJCQljb25zdCBtc2VjID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgkJCQkJCXNldEludDY0KHNwICsgOCwgbXNlYyAvIDEwMDApOwoJCQkJCQltZW0oKS5zZXRJbnQzMihzcCArIDE2LCAobXNlYyAlIDEwMDApICogMTAwMDAwMCwgdHJ1ZSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBzY2hlZHVsZVRpbWVvdXRFdmVudChkZWxheSBpbnQ2NCkgaW50MzIKCQkJCQkicnVudGltZS5zY2hlZHVsZVRpbWVvdXRFdmVudCI6IChzcCkgPT4gewoJCQkJCQljb25zdCBpZCA9IHRoaXMuX25leHRDYWxsYmFja1RpbWVvdXRJRDsKCQkJCQkJdGhpcy5fbmV4dENhbGxiYWNrVGltZW91dElEKys7CgkJCQkJCXRoaXMuX3NjaGVkdWxlZFRpbWVvdXRzLnNldChpZCwgc2V0VGltZW91dCgKCQkJCQkJCSgpID0+IHsgdGhpcy5fcmVzdW1lKCk7IH0sCgkJCQkJCQlnZXRJbnQ2NChzcCArIDgpICsgMSwgLy8gc2V0VGltZW91dCBoYXMgYmVlbiBzZWVuIHRvIGZpcmUgdXAgdG8gMSBtaWxsaXNlY29uZCBlYXJseQoJCQkJCQkpKTsKCQkJCQkJbWVtKCkuc2V0SW50MzIoc3AgKyAxNiwgaWQsIHRydWUpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgY2xlYXJUaW1lb3V0RXZlbnQoaWQgaW50MzIpCgkJCQkJInJ1bnRpbWUuY2xlYXJUaW1lb3V0RXZlbnQiOiAoc3ApID0+IHsKCQkJCQkJY29uc3QgaWQgPSBtZW0oKS5nZXRJbnQzMihzcCArIDgsIHRydWUpOwoJCQkJCQljbGVhclRpbWVvdXQodGhpcy5fc2NoZWR1bGVkVGltZW91dHMuZ2V0KGlkKSk7CgkJCQkJCXRoaXMuX3NjaGVkdWxlZFRpbWVvdXRzLmRlbGV0ZShpZCk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBnZXRSYW5kb21EYXRhKHIgW11ieXRlKQoJCQkJCSJydW50aW1lLmdldFJhbmRvbURhdGEiOiAoc3ApID0+IHsKCQkJCQkJY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhsb2FkU2xpY2Uoc3AgKyA4KSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyBzdHJpbmdWYWwodmFsdWUgc3RyaW5nKSByZWYKCQkJCQkic3lzY2FsbC9qcy5zdHJpbmdWYWwiOiAoc3ApID0+IHsKCQkJCQkJc3RvcmVWYWx1ZShzcCArIDI0LCBsb2FkU3RyaW5nKHNwICsgOCkpOwoJCQkJCX0sCgoJCQkJCS8vIGZ1bmMgdmFsdWVHZXQodiByZWYsIHAgc3RyaW5nKSByZWYKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUdldCI6IChzcCkgPT4gewoJCQkJCQljb25zdCByZXN1bHQgPSBSZWZsZWN0LmdldChsb2FkVmFsdWUoc3AgKyA4KSwgbG9hZFN0cmluZyhzcCArIDE2KSk7CgkJCQkJCXNwID0gdGhpcy5faW5zdC5leHBvcnRzLmdldHNwKCk7IC8vIHNlZSBjb21tZW50IGFib3ZlCgkJCQkJCXN0b3JlVmFsdWUoc3AgKyAzMiwgcmVzdWx0KTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlU2V0KHYgcmVmLCBwIHN0cmluZywgeCByZWYpCgkJCQkJInN5c2NhbGwvanMudmFsdWVTZXQiOiAoc3ApID0+IHsKCQkJCQkJUmVmbGVjdC5zZXQobG9hZFZhbHVlKHNwICsgOCksIGxvYWRTdHJpbmcoc3AgKyAxNiksIGxvYWRWYWx1ZShzcCArIDMyKSk7CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZUluZGV4KHYgcmVmLCBpIGludCkgcmVmCgkJCQkJInN5c2NhbGwvanMudmFsdWVJbmRleCI6IChzcCkgPT4gewoJCQkJCQlzdG9yZVZhbHVlKHNwICsgMjQsIFJlZmxlY3QuZ2V0KGxvYWRWYWx1ZShzcCArIDgpLCBnZXRJbnQ2NChzcCArIDE2KSkpOwoJCQkJCX0sCgoJCQkJCS8vIHZhbHVlU2V0SW5kZXgodiByZWYsIGkgaW50LCB4IHJlZikKCQkJCQkic3lzY2FsbC9qcy52YWx1ZVNldEluZGV4IjogKHNwKSA9PiB7CgkJCQkJCVJlZmxlY3Quc2V0KGxvYWRWYWx1ZShzcCArIDgpLCBnZXRJbnQ2NChzcCArIDE2KSwgbG9hZFZhbHVlKHNwICsgMjQpKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlQ2FsbCh2IHJlZiwgbSBzdHJpbmcsIGFyZ3MgW11yZWYpIChyZWYsIGJvb2wpCgkJCQkJInN5c2NhbGwvanMudmFsdWVDYWxsIjogKHNwKSA9PiB7CgkJCQkJCXRyeSB7CgkJCQkJCQljb25zdCB2ID0gbG9hZFZhbHVlKHNwICsgOCk7CgkJCQkJCQljb25zdCBtID0gUmVmbGVjdC5nZXQodiwgbG9hZFN0cmluZyhzcCArIDE2KSk7CgkJCQkJCQljb25zdCBhcmdzID0gbG9hZFNsaWNlT2ZWYWx1ZXMoc3AgKyAzMik7CgkJCQkJCQljb25zdCByZXN1bHQgPSBSZWZsZWN0LmFwcGx5KG0sIHYsIGFyZ3MpOwoJCQkJCQkJc3AgPSB0aGlzLl9pbnN0LmV4cG9ydHMuZ2V0c3AoKTsgLy8gc2VlIGNvbW1lbnQgYWJvdmUKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA1NiwgcmVzdWx0KTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNjQsIDEpOwoJCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA1NiwgZXJyKTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNjQsIDApOwoJCQkJCQl9CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZUludm9rZSh2IHJlZiwgYXJncyBbXXJlZikgKHJlZiwgYm9vbCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUludm9rZSI6IChzcCkgPT4gewoJCQkJCQl0cnkgewoJCQkJCQkJY29uc3QgdiA9IGxvYWRWYWx1ZShzcCArIDgpOwoJCQkJCQkJY29uc3QgYXJncyA9IGxvYWRTbGljZU9mVmFsdWVzKHNwICsgMTYpOwoJCQkJCQkJY29uc3QgcmVzdWx0ID0gUmVmbGVjdC5hcHBseSh2LCB1bmRlZmluZWQsIGFyZ3MpOwoJCQkJCQkJc3AgPSB0aGlzLl9pbnN0LmV4cG9ydHMuZ2V0c3AoKTsgLy8gc2VlIGNvbW1lbnQgYWJvdmUKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA0MCwgcmVzdWx0KTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNDgsIDEpOwoJCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJCXN0b3JlVmFsdWUoc3AgKyA0MCwgZXJyKTsKCQkJCQkJCW1lbSgpLnNldFVpbnQ4KHNwICsgNDgsIDApOwoJCQkJCQl9CgkJCQkJfSwKCgkJCQkJLy8gZnVuYyB2YWx1ZU5ldyh2IHJlZiwgYXJncyBbXXJlZikgKHJlZiwgYm9vbCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZU5ldyI6IChzcCkgPT4gewoJCQkJCQl0cnkgewoJCQkJCQkJY29uc3QgdiA9IGxvYWRWYWx1ZShzcCArIDgpOwoJCQkJCQkJY29uc3QgYXJncyA9IGxvYWRTbGljZU9mVmFsdWVzKHNwICsgMTYpOwoJCQkJCQkJY29uc3QgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QodiwgYXJncyk7CgkJCQkJCQlzcCA9IHRoaXMuX2luc3QuZXhwb3J0cy5nZXRzcCgpOyAvLyBzZWUgY29tbWVudCBhYm92ZQoJCQkJCQkJc3RvcmVWYWx1ZShzcCArIDQwLCByZXN1bHQpOwoJCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMSk7CgkJCQkJCX0gY2F0Y2ggKGVycikgewoJCQkJCQkJc3RvcmVWYWx1ZShzcCArIDQwLCBlcnIpOwoJCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyA0OCwgMCk7CgkJCQkJCX0KCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlTGVuZ3RoKHYgcmVmKSBpbnQKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUxlbmd0aCI6IChzcCkgPT4gewoJCQkJCQlzZXRJbnQ2NChzcCArIDE2LCBwYXJzZUludChsb2FkVmFsdWUoc3AgKyA4KS5sZW5ndGgpKTsKCQkJCQl9LAoKCQkJCQkvLyB2YWx1ZVByZXBhcmVTdHJpbmcodiByZWYpIChyZWYsIGludCkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZVByZXBhcmVTdHJpbmciOiAoc3ApID0+IHsKCQkJCQkJY29uc3Qgc3RyID0gZW5jb2Rlci5lbmNvZGUoU3RyaW5nKGxvYWRWYWx1ZShzcCArIDgpKSk7CgkJCQkJCXN0b3JlVmFsdWUoc3AgKyAxNiwgc3RyKTsKCQkJCQkJc2V0SW50NjQoc3AgKyAyNCwgc3RyLmxlbmd0aCk7CgkJCQkJfSwKCgkJCQkJLy8gdmFsdWVMb2FkU3RyaW5nKHYgcmVmLCBiIFtdYnl0ZSkKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUxvYWRTdHJpbmciOiAoc3ApID0+IHsKCQkJCQkJY29uc3Qgc3RyID0gbG9hZFZhbHVlKHNwICsgOCk7CgkJCQkJCWxvYWRTbGljZShzcCArIDE2KS5zZXQoc3RyKTsKCQkJCQl9LAoKCQkJCQkvLyBmdW5jIHZhbHVlSW5zdGFuY2VPZih2IHJlZiwgdCByZWYpIGJvb2wKCQkJCQkic3lzY2FsbC9qcy52YWx1ZUluc3RhbmNlT2YiOiAoc3ApID0+IHsKCQkJCQkJbWVtKCkuc2V0VWludDgoc3AgKyAyNCwgbG9hZFZhbHVlKHNwICsgOCkgaW5zdGFuY2VvZiBsb2FkVmFsdWUoc3AgKyAxNikpOwoJCQkJCX0sCgoJCQkJCSJkZWJ1ZyI6ICh2YWx1ZSkgPT4gewoJCQkJCQljb25zb2xlLmxvZyh2YWx1ZSk7CgkJCQkJfSwKCQkJCX0KCQkJfTsKCQl9CgoJCWFzeW5jIHJ1bihpbnN0YW5jZSkgewoJCQl0aGlzLl9pbnN0ID0gaW5zdGFuY2U7CgkJCXRoaXMuX3ZhbHVlcyA9IFsgLy8gVE9ETzogZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCQlOYU4sCgkJCQkwLAoJCQkJbnVsbCwKCQkJCXRydWUsCgkJCQlmYWxzZSwKCQkJCWdsb2JhbCwKCQkJCXRoaXMuX2luc3QuZXhwb3J0cy5tZW0sCgkJCQl0aGlzLAoJCQldOwoJCQl0aGlzLl9yZWZzID0gbmV3IE1hcCgpOwoJCQl0aGlzLmV4aXRlZCA9IGZhbHNlOwoKCQkJY29uc3QgbWVtID0gbmV3IERhdGFWaWV3KHRoaXMuX2luc3QuZXhwb3J0cy5tZW0uYnVmZmVyKQoKCQkJLy8gUGFzcyBjb21tYW5kIGxpbmUgYXJndW1lbnRzIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgdG8gV2ViQXNzZW1ibHkgYnkgd3JpdGluZyB0aGVtIHRvIHRoZSBsaW5lYXIgbWVtb3J5LgoJCQlsZXQgb2Zmc2V0ID0gNDA5NjsKCgkJCWNvbnN0IHN0clB0ciA9IChzdHIpID0+IHsKCQkJCWxldCBwdHIgPSBvZmZzZXQ7CgkJCQluZXcgVWludDhBcnJheShtZW0uYnVmZmVyLCBvZmZzZXQsIHN0ci5sZW5ndGggKyAxKS5zZXQoZW5jb2Rlci5lbmNvZGUoc3RyICsgIlwwIikpOwoJCQkJb2Zmc2V0ICs9IHN0ci5sZW5ndGggKyAoOCAtIChzdHIubGVuZ3RoICUgOCkpOwoJCQkJcmV0dXJuIHB0cjsKCQkJfTsKCgkJCWNvbnN0IGFyZ2MgPSB0aGlzLmFyZ3YubGVuZ3RoOwoKCQkJY29uc3QgYXJndlB0cnMgPSBbXTsKCQkJdGhpcy5hcmd2LmZvckVhY2goKGFyZykgPT4gewoJCQkJYXJndlB0cnMucHVzaChzdHJQdHIoYXJnKSk7CgkJCX0pOwoKCQkJY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuZW52KS5zb3J0KCk7CgkJCWFyZ3ZQdHJzLnB1c2goa2V5cy5sZW5ndGgpOwoJCQlrZXlzLmZvckVhY2goKGtleSkgPT4gewoJCQkJYXJndlB0cnMucHVzaChzdHJQdHIoYCR7a2V5fT0ke3RoaXMuZW52W2tleV19YCkpOwoJCQl9KTsKCgkJCWNvbnN0IGFyZ3YgPSBvZmZzZXQ7CgkJCWFyZ3ZQdHJzLmZvckVhY2goKHB0cikgPT4gewoJCQkJbWVtLnNldFVpbnQzMihvZmZzZXQsIHB0ciwgdHJ1ZSk7CgkJCQltZW0uc2V0VWludDMyKG9mZnNldCArIDQsIDAsIHRydWUpOwoJCQkJb2Zmc2V0ICs9IDg7CgkJCX0pOwoKCQkJdGhpcy5faW5zdC5leHBvcnRzLnJ1bihhcmdjLCBhcmd2KTsKCQkJaWYgKHRoaXMuZXhpdGVkKSB7CgkJCQl0aGlzLl9yZXNvbHZlRXhpdFByb21pc2UoKTsKCQkJfQoJCQlhd2FpdCB0aGlzLl9leGl0UHJvbWlzZTsKCQl9CgoJCV9yZXN1bWUoKSB7CgkJCWlmICh0aGlzLmV4aXRlZCkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCJHbyBwcm9ncmFtIGhhcyBhbHJlYWR5IGV4aXRlZCIpOwoJCQl9CgkJCXRoaXMuX2luc3QuZXhwb3J0cy5yZXN1bWUoKTsKCQkJaWYgKHRoaXMuZXhpdGVkKSB7CgkJCQl0aGlzLl9yZXNvbHZlRXhpdFByb21pc2UoKTsKCQkJfQoJCX0KCgkJX21ha2VGdW5jV3JhcHBlcihpZCkgewoJCQljb25zdCBnbyA9IHRoaXM7CgkJCXJldHVybiBmdW5jdGlvbiAoKSB7CgkJCQljb25zdCBldmVudCA9IHsgaWQ6IGlkLCB0aGlzOiB0aGlzLCBhcmdzOiBhcmd1bWVudHMgfTsKCQkJCWdvLl9wZW5kaW5nRXZlbnQgPSBldmVudDsKCQkJCWdvLl9yZXN1bWUoKTsKCQkJCXJldHVybiBldmVudC5yZXN1bHQ7CgkJCX07CgkJfQoJfQoKCWlmIChpc05vZGVKUykgewoJCWlmIChwcm9jZXNzLmFyZ3YubGVuZ3RoIDwgMykgewoJCQlwcm9jZXNzLnN0ZGVyci53cml0ZSgidXNhZ2U6IGdvX2pzX3dhc21fZXhlYyBbd2FzbSBiaW5hcnldIFthcmd1bWVudHNdXG4iKTsKCQkJcHJvY2Vzcy5leGl0KDEpOwoJCX0KCgkJY29uc3QgZ28gPSBuZXcgR28oKTsKCQlnby5hcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpOwoJCWdvLmVudiA9IE9iamVjdC5hc3NpZ24oeyBUTVBESVI6IHJlcXVpcmUoIm9zIikudG1wZGlyKCkgfSwgcHJvY2Vzcy5lbnYpOwoJCWdvLmV4aXQgPSBwcm9jZXNzLmV4aXQ7CgkJV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoZnMucmVhZEZpbGVTeW5jKHByb2Nlc3MuYXJndlsyXSksIGdvLmltcG9ydE9iamVjdCkudGhlbigocmVzdWx0KSA9PiB7CgkJCXByb2Nlc3Mub24oImV4aXQiLCAoY29kZSkgPT4geyAvLyBOb2RlLmpzIGV4aXRzIGlmIG5vIGV2ZW50IGhhbmRsZXIgaXMgcGVuZGluZwoJCQkJaWYgKGNvZGUgPT09IDAgJiYgIWdvLmV4aXRlZCkgewoJCQkJCS8vIGRlYWRsb2NrLCBtYWtlIEdvIHByaW50IGVycm9yIGFuZCBzdGFjayB0cmFjZXMKCQkJCQlnby5fcGVuZGluZ0V2ZW50ID0geyBpZDogMCB9OwoJCQkJCWdvLl9yZXN1bWUoKTsKCQkJCX0KCQkJfSk7CgkJCXJldHVybiBnby5ydW4ocmVzdWx0Lmluc3RhbmNlKTsKCQl9KS5jYXRjaCgoZXJyKSA9PiB7CgkJCXRocm93IGVycjsKCQl9KTsKCX0KfSkoKTs=`)

	return decoded
}
